{
  "type": "rolling",
  "batchSize": 3,
  "action": "deploy",
  "targetPlatform": "ECS",
  "applicationData": {
    "artifactUrl": "${ARTIFACT_URL}",
    "version": "${RELEASE_VERSION}"
  },
  "runtime": {
    "type": "java",
    "javaVersion": "17"
  },
  "profiles": [
    {
      "name": "jvmOptions",
      "options": [
        "-Xmx${MEMORY}",
        "-Xms${MEMORY}",
        "-XX:+UseG1GC",
        "-XX:+UseStringDeduplication"
      ]
    },
    {
      "name": "environmentVariables",
      "variables": {
        "DEPLOY_TIMESTAMP": "${DEPLOY_TIMESTAMP}",
        "CI_JOB_NAME": "${CI_JOB_NAME}",
        "CI_JOB_STAGE": "${CI_JOB_STAGE}",
        "CI_JOB_ID": "${CI_JOB_ID}",
        "CI_JOB_URL": "${CI_JOB_URL}",
        "CI_PIPELINE_ID": "${CI_PIPELINE_ID}",
        "CI_PIPELINE_URL": "${CI_PIPELINE_URL}",
        "CI_PROJECT_URL": "${CI_PROJECT_URL}",
        "GITLAB_USER_EMAIL": "${GITLAB_USER_EMAIL}",
        "SENTRY_DSN": "${FLUX_SENTRY_DSN}",
        "SENTRY_ENVIRONMENT": "${DTAP}-${BUSINESS_ID}-${ALIAS}-${APP_ID}",
        "SENTRY_RELEASE": "${RELEASE_VERSION}",
        "CHANCELLOR_DASHBOARD_URL": "https://chancellor.osp.tech/dashboard/${APP_ID}/ecs/${DTAP}-${BUSINESS_ID}-${ALIAS}-${APP_ID}/summary",
        "LOGGING_URL": "${LOGGING_URL}app/kibana#/discover?_g=(filters:!())&_a=(columns:!(logger,level,message),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'03216320-de80-11e8-b4c6-19ebb680fa86',key:appId,negate:!f,params:(query:${APP_ID}),type:phrase,value:${APP_ID}),query:(match:(appId:(query:${APP_ID},type:phrase)))),('$state':(store:appState),exists:(field:message),meta:(alias:!n,disabled:!f,index:'03216320-de80-11e8-b4c6-19ebb680fa86',key:message,negate:!f,type:exists,value:exists)),('$state':(store:appState),exists:(field:logger),meta:(alias:!n,disabled:!f,index:'03216320-de80-11e8-b4c6-19ebb680fa86',key:logger,negate:!f,type:exists,value:exists)),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:d6f6b8b0-d1c4-11ea-92fe-d9dc864ba36b,key:logger,negate:!t,params:(query:TomcatAccessLog),type:phrase,value:TomcatAccessLog),query:(match:(logger:(query:TomcatAccessLog,type:phrase)))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:d6f6b8b0-d1c4-11ea-92fe-d9dc864ba36b,key:appVersion,negate:!f,params:(query:'${RELEASE_VERSION}'),type:phrase,value:'${RELEASE_VERSION}'),query:(match:(appVersion:(query:'${RELEASE_VERSION}',type:phrase)))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:d6f6b8b0-d1c4-11ea-92fe-d9dc864ba36b,key:level,negate:!f,params:(query:ERROR),type:phrase,value:ERROR),query:(match:(level:(query:ERROR,type:phrase)))),('$state':(store:appState),meta:(alias:!n,disabled:!t,index:d6f6b8b0-d1c4-11ea-92fe-d9dc864ba36b,key:level,negate:!f,params:!(ERROR,WARN),type:phrases,value:'ERROR,%20WARN'),query:(bool:(minimum_should_match:1,should:!((match_phrase:(level:ERROR)),(match_phrase:(level:WARN))))))),index:d6f6b8b0-d1c4-11ea-92fe-d9dc864ba36b,interval:auto,query:(language:lucene,query:''),sort:!('@timestamp',desc))",
        "AZURE_AD_CLIENT_ID": "${AZURE_AD_CLIENT_ID}",
        "AZURE_AD_CLIENT_SECRET": "${AZURE_AD_CLIENT_SECRET}"
      }
    },
    {
      "name": "autoScaling",
      "minSize": 3,
      "maxSize": 3
    },
    {
      "name": "healthcheck",
      "interval": "${HEALTHCHECK_INTERVAL}",
      "gracePeriod": "${HEALTHCHECK_GRACE_PERIOD}"
    },
    {
      "name": "instanceType/v2",
      "memory": "${INSTANCE_MEMORY}",
      "cpu": "${INSTANCE_CPU}"
    },
    {
      "name": "newRelic",
      "agentVersion": "${NEWRELIC_VERSION}"
    },
    {
      "name": "jarJar"
    },
    {
      "name": "tags",
      "tags": {
        "availability": "no_chaos"
      }
    },
    {
      "name": "serviceDiscovery",
      "serviceRegistries": [
        {
          "port": 8080,
          "protocol": "TCP"
        }
      ]
    }
  ]
}
